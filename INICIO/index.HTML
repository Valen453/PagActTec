<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GOODLOOKING - Tienda de Ropa</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="Estilos.css">
    <style>
        .oculto { display: none !important; } /* Para asegurar que se oculte, Bootstrap puede interferir a veces */
    </style>
</head>
<body>
  <header class="site-header">
    <div class="container">
      <span class="site-title">GOODLOOKING</span>
    </div>
  </header>
  
  <main class="page-content">
    <section id="productos-destacados-carousel-section" class="container mt-4 mb-5">
      <h2 class="text-center mb-4 section-title">Productos Destacados</h2>
      <div id="carouselDestacados" class="carousel slide carousel-fade" data-bs-ride="carousel">
        <div class="carousel-inner" id="carouselDestacadosInner">
          </div>
        <button class="carousel-control-prev" type="button" data-bs-target="#carouselDestacados" data-bs-slide="prev">
          <span class="carousel-control-prev-icon" aria-hidden="true"></span>
          <span class="visually-hidden">Anterior</span>
        </button>
        <button class="carousel-control-next" type="button" data-bs-target="#carouselDestacados" data-bs-slide="next">
          <span class="carousel-control-next-icon" aria-hidden="true"></span>
          <span class="visually-hidden">Siguiente</span>
        </button>
      </div>
    </section>

    <div class="container">
        <form class="checkout-form p-4 p-md-5">
        <h2 class="form-title text-center">Finaliza tu Compra</h2>
        
        <section class="form-section">
            <h3>Seleccionar Productos</h3>
            <div id="productos-disponibles" class="row mt-3 gy-4">
            </div>
        </section>

        <section class="form-section">
            <h3>Forma de Pago</h3>
            <label for="forma_pago" class="form-label">Elige una opción:</label>
            <select class="form-select" name="forma_pago" id="forma_pago" onchange="mostrarOpcionesPago()" required>
            <option value="">Seleccione una opción</option>
            <option value="efectivo">Efectivo</option>
            <option value="tarjeta">Tarjeta Débito/Crédito</option>
            <option value="transferencia">Transferencia Bancaria</option>
            </select>
        </section>

        <div id="datos_tarjeta" class="oculto form-section-dynamic p-3 rounded">
            <h4>Datos de la Tarjeta</h4>
            <div class="mb-3">
                <label for="numero_tarjeta" class="form-label">Número de Tarjeta:</label>
                <input type="text" class="form-control" id="numero_tarjeta" name="numero_tarjeta" placeholder="0000 0000 0000 0000">
            </div>
            <div class="mb-3">
                <label for="nombre_titular" class="form-label">Nombre del Titular:</label>
                <input type="text" class="form-control" id="nombre_titular" name="nombre_titular" placeholder="Nombre como aparece en la tarjeta">
            </div>
            <div class="row">
                <div class="col-md-6 mb-3">
                    <label for="vencimiento" class="form-label">Fecha de Vencimiento (MM/AA):</label>
                    <input type="month" class="form-control" id="vencimiento" name="vencimiento">
                </div>
                <div class="col-md-6 mb-3">
                    <label for="cvv" class="form-label">Código de Seguridad (CVV):</label>
                    <input type="text" class="form-control" id="cvv" name="cvv" placeholder="123" maxlength="4">
                </div>
            </div>
        </div>

        <div id="alias_transferencia" class="oculto form-section-dynamic p-3 rounded">
            <h4>Transferencia Bancaria</h4>
            <p class="alias-info"><strong>Alias de la empresa para transferencias:</strong> Good.Looking</p>
        </div>

        <section class="form-section">
            <h3>Forma de Entrega</h3>
            <div class="opciones-entrega d-flex flex-wrap gap-3">
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="entrega" id="entregaLocal" value="local" onclick="mostrarEnvio(false)" required>
                    <label class="form-check-label" for="entregaLocal">Retiro en Local</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="entrega" id="entregaEnvio" value="envio" onclick="mostrarEnvio(true)">
                    <label class="form-check-label" for="entregaEnvio">Envío a Domicilio</label>
                </div>
            </div>
        </section>

        <div id="direccion_envio" class="oculto form-section-dynamic p-3 rounded">
            <h4>Dirección de Envío</h4>
            <div class="mb-3">
                <label for="direccion" class="form-label">Escribe tu dirección completa:</label>
                <textarea class="form-control" id="direccion" name="direccion" rows="3" placeholder="Calle, Número, Localidad, Provincia, Código Postal"></textarea>
            </div>
        </div>

        <a href="Registro.html" class="btn boton-finalizar w-100 mt-4">Continuar al Registro</a>
        </form>
    </div>
  </main>

  <footer class="site-footer text-center py-4 mt-5">
    <div class="container">
      <p>&copy; <span id="currentYear"></span> GOODLOOKING. Todos los derechos reservados.</p>
    </div>
  </footer>

  <div class="modal fade" id="productoModal" tabindex="-1" aria-labelledby="productoModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="productoModalLabel">Detalles del Producto</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="row">
            <div class="col-md-6 text-center">
              <img src="" alt="Imagen del Producto" id="modalProductoImagen" class="img-fluid rounded mb-3" style="max-height: 400px; object-fit: contain;">
            </div>
            <div class="col-md-6">
              <h3 id="modalProductoNombre" class="mb-2"></h3>
              <p id="modalProductoDescripcion" class="mb-3"></p>
              <p class="mb-1"><strong>Tipo:</strong> <span id="modalProductoTipo"></span></p>
              <p class="mb-1"><strong>Talla disponible:</strong> <span id="modalProductoTalla" class="fw-bold"></span></p>
              <p class="mb-3"><strong>Precio:</strong> <span id="modalProductoPrecio" class="fw-bold fs-5"></span></p>
              <button type="button" class="btn btn-outline-light w-100" data-bs-dismiss="modal">Cerrar</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>


  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
  <script>
    document.getElementById('currentYear').textContent = new Date().getFullYear();

    function mostrarOpcionesPago() {
      const formaPago = document.getElementById('forma_pago').value;
      document.getElementById('datos_tarjeta').classList.add('oculto');
      document.getElementById('alias_transferencia').classList.add('oculto');

      if (formaPago === 'tarjeta') {
        document.getElementById('datos_tarjeta').classList.remove('oculto');
      } else if (formaPago === 'transferencia') {
        document.getElementById('alias_transferencia').classList.remove('oculto');
      }
    }

    function mostrarEnvio(esEnvio) {
      const campoDireccion = document.getElementById('direccion_envio');
      if (esEnvio) {
        campoDireccion.classList.remove('oculto');
      } else {
        campoDireccion.classList.add('oculto');
      }
    }

    // --- Lógica para el Carrusel y Lista de Productos ---
    document.addEventListener('DOMContentLoaded', function() {
        const todasLasPrendas = JSON.parse(localStorage.getItem('prendas')) || [];
        
        cargarCarruselDestacados(todasLasPrendas);
        cargarProductosParaCheckout(todasLasPrendas);
    });

    function cargarCarruselDestacados(prendas) {
        const carouselInner = document.getElementById('carouselDestacadosInner');
        if (!carouselInner) return;

        const prendasDestacadas = prendas.filter(p => p.destacado);

        if (prendasDestacadas.length === 0) {
            document.getElementById('productos-destacados-carousel-section').classList.add('oculto');
            return;
        }

        prendasDestacadas.forEach((prenda, index) => {
            const carouselItem = document.createElement('div');
            carouselItem.className = `carousel-item ${index === 0 ? 'active' : ''}`;
            carouselItem.innerHTML = `
                <img src="${prenda.imagen}" class="d-block w-100 carousel-img" alt="${prenda.nombre}">
                <div class="carousel-caption d-none d-md-block">
                    <h5>${prenda.nombre}</h5>
                    <p>${prenda.descripcion ? prenda.descripcion.substring(0,80)+'...' : ''}</p>
                </div>
            `;
            carouselInner.appendChild(carouselItem);
        });
    }

    function cargarProductosParaCheckout(prendas) {
      const contenedorProductos = document.getElementById('productos-disponibles');
      if (!contenedorProductos) return;

      if (prendas.length === 0) {
        contenedorProductos.innerHTML = '<p class="col-12 text-center no-productos-disponibles">No hay productos disponibles. Por favor, carga productos en la sección BDD.</p>';
        return;
      }

      prendas.forEach(prenda => {
        const productoCol = document.createElement('div');
        // Clases de Bootstrap para la grilla: col-md-4 (3 por fila en medium), col-sm-6 (2 en small), col-12 (1 en extra small)
        productoCol.className = 'col-lg-4 col-md-6 col-sm-12'; 
        
        productoCol.innerHTML = `
          <div class="card producto-card h-100">
            <img src="${prenda.imagen}" class="card-img-top producto-card-img" alt="${prenda.nombre}">
            <div class="card-body d-flex flex-column">
              <h5 class="card-title producto-card-nombre">${prenda.nombre}</h5>
              <p class="card-text producto-card-descripcion flex-grow-1">${prenda.descripcion ? (prenda.descripcion.length > 80 ? prenda.descripcion.substring(0, 80) + '...' : prenda.descripcion) : 'Descripción no disponible.'}</p>
              <p class="card-text producto-card-precio"><strong>Precio:</strong> $${prenda.precio}</p>
            </div>
            <div class="card-footer producto-card-footer">
                <div class="form-check mb-2">
                    <input class="form-check-input producto-checkbox-checkout" type="checkbox" value="${prenda.id}" id="prod-${prenda.id}" name="productos_seleccionados[]" data-precio="${prenda.precio}">
                    <label class="form-check-label" for="prod-${prenda.id}">
                        Seleccionar
                    </label>
                </div>
                <button type="button" class="btn btn-sm boton-ver-detalles w-100" 
                        data-bs-toggle="modal" data-bs-target="#productoModal"
                        data-id="${prenda.id}"
                        data-nombre="${prenda.nombre}" 
                        data-descripcion="${prenda.descripcion || 'Descripción no disponible.'}"
                        data-imagen="${prenda.imagen}"
                        data-talla="${prenda.talla}"
                        data-tipo="${prenda.tipo || 'No especificado'}"
                        data-precio="$${prenda.precio}">
                  Ver Detalles
                </button>
            </div>
          </div>
        `;
        contenedorProductos.appendChild(productoCol);
      });

      // Añadir event listener para los botones "Ver Detalles" para popular el modal
      const modal = document.getElementById('productoModal');
      if (modal) {
        modal.addEventListener('show.bs.modal', function (event) {
            const button = event.relatedTarget; // Botón que disparó el modal
            
            document.getElementById('modalProductoNombre').textContent = button.getAttribute('data-nombre');
            document.getElementById('modalProductoImagen').src = button.getAttribute('data-imagen');
            document.getElementById('modalProductoDescripcion').textContent = button.getAttribute('data-descripcion');
            document.getElementById('modalProductoTalla').textContent = button.getAttribute('data-talla');
            document.getElementById('modalProductoTipo').textContent = button.getAttribute('data-tipo');
            document.getElementById('modalProductoPrecio').textContent = button.getAttribute('data-precio');
            document.getElementById('productoModalLabel').textContent = button.getAttribute('data-nombre'); // Título del modal
        });
      }
    }
  </script>

</body>
</html>